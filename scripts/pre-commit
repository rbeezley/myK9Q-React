#!/bin/sh
# Pre-commit hook for myK9Q React
# Runs quality checks before allowing commit:
# 1. TypeScript type checking
# 2. ESLint
# 3. Unit tests

echo ""
echo "========================================"
echo "  Pre-commit Quality Checks"
echo "========================================"
echo ""

# Track overall status
FAILED=0

# Step 1: Type check
echo "1/3 Running type check..."
npm run typecheck --silent
if [ $? -ne 0 ]; then
  echo "   TypeScript errors found. Please fix before committing."
  FAILED=1
else
  echo "   Type check passed!"
fi

# Step 2: Lint
echo ""
echo "2/3 Running ESLint..."
npm run lint --silent
if [ $? -ne 0 ]; then
  echo "   ESLint errors found. Please fix before committing."
  FAILED=1
else
  echo "   Lint passed!"
fi

# Step 3: Tests
echo ""
echo "3/3 Running tests..."
npx vitest run --reporter=dot 2>&1
if [ $? -ne 0 ]; then
  echo "   Tests failed. Please fix before committing."
  FAILED=1
else
  echo "   All tests passed!"
fi

# Final result
echo ""
echo "========================================"
if [ $FAILED -ne 0 ]; then
  echo "  COMMIT BLOCKED - Please fix issues above"
  echo "========================================"
  exit 1
fi

echo "  All checks passed - Committing..."
echo "========================================"
exit 0
